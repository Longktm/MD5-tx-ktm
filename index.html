<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KTM Tool AI</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; background: #000; color: #0f0; font-size: 1.25rem; }
    input, button, select { font-size: 1.2rem; margin: 0.5rem 0; padding: 0.5rem; background: #111; color: #0f0; border: 1px solid #0f0; }
    textarea { width: 100%; height: 100px; font-size: 1rem; background: #111; color: #0f0; border: 1px solid #0f0; }
    .warning { color: yellow; }
    .result { font-weight: bold; margin-top: 1rem; }
    .ev-positive { color: #0f0; }
    .ev-negative { color: red; }
    .ev-uncertain { color: yellow; }
  </style>
</head>
<body>
  <h2>KTM TOOL AI - Phân tích MD5 tài xỉu</h2>
  <label>Nhập mã MD5:</label>
  <input type="text" id="md5" placeholder="Dán mã MD5 vào đây">
  <button onclick="analyze()">Phân tích</button>
  <div class="result" id="output"></div>
  <div style="margin-top:1rem">
    <label>Sửa kết quả thực tế:</label>
    <input type="radio" name="trueResult" value="tài"> Tài
    <input type="radio" name="trueResult" value="xỉu"> Xỉu
    <button onclick="saveResult()">Lưu kết quả</button>
  </div>
  <script>
    let history = JSON.parse(localStorage.getItem("ktm_history") || "[]");function getFeatures(md5) {
  const f = (md5.match(/[a-f]/g) || []).length;
  const d = (md5.match(/[0-9]/g) || []).length;
  const last = md5.slice(-1);
  return { f, d, last };
}

function analyze() {
  const md5 = document.getElementById("md5").value.trim();
  if (md5.length !== 32) return alert("Mã MD5 không hợp lệ");
  const { f, d, last } = getFeatures(md5);

  const filtered = history.filter(h => h.f === f && h.d === d && h.last === last);
  const total = filtered.length;
  const tx = filtered.reduce((acc, cur) => {
    acc[cur.result] = (acc[cur.result] || 0) + 1;
    return acc;
  }, {});

  let predicted = "?", confidence = 0;
  if (total >= 5) {
    const pTai = (tx["tài"] || 0) / total;
    const pXiu = (tx["xỉu"] || 0) / total;
    predicted = pTai > pXiu ? "Tài" : "Xỉu";
    confidence = Math.max(pTai, pXiu);
  }

  const kq = predicted !== "?" ? predicted : "Không chắc chắn";
  const ev = predicted === "Tài" ? ((tx["tài"] || 0) - (tx["xỉu"] || 0)) / total : ((tx["xỉu"] || 0) - (tx["tài"] || 0)) / total;
  const evPercent = predicted === "?" ? 0 : Math.round(ev * 100);

  const evClass = predicted === "?" ? "ev-uncertain" : (ev > 0 ? "ev-positive" : "ev-negative");
  const note = total < 5 ? '<span class="warning">(Dữ liệu còn yếu, cẩn thận)</span>' : '';

  document.getElementById("output").innerHTML = `
    Kết quả dự đoán: <strong>${kq}</strong><br>
    Xác suất: ${(confidence * 100).toFixed(1)}%<br>
    EV: <span class="${evClass}">${evPercent}%</span><br>
    Số mẫu học: ${total} ${note}
  `;
}

function saveResult() {
  const md5 = document.getElementById("md5").value.trim();
  if (md5.length !== 32) return alert("Mã MD5 không hợp lệ");
  const radios = document.getElementsByName("trueResult");
  let result;
  for (const r of radios) if (r.checked) result = r.value;
  if (!result) return alert("Vui lòng chọn kết quả thực tế");

  const { f, d, last } = getFeatures(md5);
  history.push({ f, d, last, result });
  localStorage.setItem("ktm_history", JSON.stringify(history));
  alert("Đã lưu kết quả thực tế");
  analyze();
}

  </script>
</body>
</html>

<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Phân tích MD5 Tài/Xỉu</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
    th { background-color: #f2f2f2; }
    input[type='text'] { width: 400px; }
    .suggest { font-weight: bold; }
    .corrected { color: green; }
    .wrong { color: red; }
  </style>
</head>
<body>
  <h2>Phân tích mã MD5 Tài/Xỉu</h2>
  <input type="text" id="md5Input" placeholder="Dán mã MD5 vào đây">
  <button onclick="analyzeMD5()">Phân tích</button>
  <p id="result"></p>  <h3>Lịch sử đã lưu</h3>
  <table id="history">
    <tr>
      <th>MD5</th><th>F</th><th>D</th><th>Cuối</th><th>Gợi ý</th><th>Đã sửa</th>
    </tr>
  </table>  <script>
    let data = JSON.parse(localStorage.getItem('md5Data') || '[]');
    let trainingData = JSON.parse(localStorage.getItem('trainingStats') || '{}');

    function countFD(md5) {
      let f = 0, d = 0;
      for (let c of md5) {
        if (c >= 'a' && c <= 'f') f++;
        else if (c >= '0' && c <= '9') d++;
      }
      return [f, d];
    }

    function suggestByStats(f, d, lastChar) {
      const key = `${f}-${d}-${lastChar}`;
      const stats = trainingData[key];
      if (!stats) return null;
      return stats.tai > stats.xiu ? 'tài' : 'xỉu';
    }

    function defaultSuggest(f, d, lastChar) {
      const num = parseInt(lastChar, 16);
      return (f + d + num) % 2 === 0 ? 'tài' : 'xỉu';
    }

    function analyzeMD5() {
      const md5 = document.getElementById("md5Input").value.trim().toLowerCase();
      if (md5.length !== 32 && md5.length !== 64) return alert("Mã MD5 không hợp lệ");
      const [f, d] = countFD(md5);
      const lastChar = md5[md5.length - 1];

      let suggestion = suggestByStats(f, d, lastChar) || defaultSuggest(f, d, lastChar);

      document.getElementById("result").innerHTML =
        `F = ${f}, D = ${d}, Cuối = ${lastChar} ⇒ <span class='suggest'>${suggestion}</span>`;

      data.push({ md5, f, d, last: lastChar, suggest: suggestion, corrected: false });
      localStorage.setItem('md5Data', JSON.stringify(data));
      renderTable();
    }

    function renderTable() {
      const table = document.getElementById("history");
      table.innerHTML = `<tr><th>MD5</th><th>F</th><th>D</th><th>Cuối</th><th>Gợi ý</th><th>Đã sửa</th></tr>`;
      data.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.md5}</td>
          <td>${item.f}</td>
          <td>${item.d}</td>
          <td>${item.last}</td>
          <td>${item.suggest}</td>
          <td><input type="checkbox" ${item.corrected ? 'checked' : ''} onchange="correct(${index}, this.checked)"></td>
        `;
        table.appendChild(row);
      });
    }

    function correct(index, isCorrect) {
      data[index].corrected = isCorrect;
      const key = `${data[index].f}-${data[index].d}-${data[index].last}`;

      if (!trainingData[key]) trainingData[key] = { tai: 0, xiu: 0 };
      const suggest = data[index].suggest;

      if (isCorrect) {
        trainingData[key][suggest]++;
      } else {
        trainingData[key][suggest] = Math.max(0, trainingData[key][suggest] - 1);
      }

      localStorage.setItem('md5Data', JSON.stringify(data));
      localStorage.setItem('trainingStats', JSON.stringify(trainingData));
      renderTable();
    }

    renderTable();
  </script></body>
</html>

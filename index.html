<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KTM Tool - Hacker Tài Xỉu</title>
  <style>
    body {
      background: black;
      color: #00ff00;
      font-family: monospace;
      padding: 20px;
      font-size: 20px;
    }
    input, button, select {
      font-size: 20px;
      padding: 5px;
      margin: 5px 0;
    }
    .warning {
      color: yellow;
    }
    .result {
      font-weight: bold;
      font-size: 24px;
    }
  </style>
</head>
<body>
  <h1>KTM Tool - Phân tích MD5 Tài Xỉu</h1>
  <textarea id="md5input" rows="4" cols="70" placeholder="Dán mã MD5 vào đây..."></textarea><br>
  <button onclick="phanTich()">Phân tích</button>
  <div id="phanTichKetQua"></div>
  <div class="result" id="goiY"></div>
  <div id="evDisplay"></div>
  <div>
    <label>Kết quả đúng:</label>
    <label><input type="radio" name="ketqua" value="Tài"> Tài</label>
    <label><input type="radio" name="ketqua" value="Xỉu"> Xỉu</label>
    <button onclick="luuKetQua()">Lưu và Học</button>
  </div>
  <script>
    let weights = JSON.parse(localStorage.getItem("tx_weights") || '{"F":1,"D":-1,"Last":0}');function clamp(value, min, max) {
  return Math.max(min, Math.min(max, value));
}

function updateWeights(f, d, lastCharScore, result) {
  const alpha = 0.1;
  const direction = result === "Tài" ? 1 : -1;

  weights.F += alpha * direction * f;
  weights.D += alpha * direction * d;
  weights.Last += alpha * direction * lastCharScore;

  weights.F = clamp(weights.F, -10, 10);
  weights.D = clamp(weights.D, -10, 10);
  weights.Last = clamp(weights.Last, -10, 10);
}

let currentFeatures = {};

function phanTich() {
  const md5 = document.getElementById("md5input").value.trim();
  if (md5.length !== 32) {
    alert("MD5 phải đủ 32 ký tự.");
    return;
  }
  const f = (md5.match(/f/gi) || []).length;
  const d = (md5.match(/d/gi) || []).length;
  const lastChar = md5[md5.length - 1];
  const lastCharCode = lastChar.charCodeAt(0);
  const lastCharScore = /[0-9]/.test(lastChar) ? parseInt(lastChar) : lastCharCode % 10;

  const rawScore = f * weights.F + d * weights.D + lastCharScore * weights.Last;
  const normalized = Math.tanh(rawScore);
  const ev = (normalized * 50 + 50).toFixed(2);

  const goiY = normalized > 0.1 ? "Tài" : normalized < -0.1 ? "Xỉu" : "Không chắc chắn";

  document.getElementById("phanTichKetQua").innerText = `F = ${f}, D = ${d}, Cuối = '${lastChar}' (${lastCharScore})`;
  document.getElementById("goiY").innerText = `Gợi ý: ${goiY}`;
  document.getElementById("evDisplay").innerText = `EV: ${ev}%`;

  currentFeatures = { f, d, lastCharScore };
}

function luuKetQua() {
  const radios = document.getElementsByName("ketqua");
  let kq = null;
  for (let r of radios) if (r.checked) kq = r.value;
  if (!kq || !currentFeatures.f) {
    alert("Phân tích trước rồi chọn kết quả đúng.");
    return;
  }
  updateWeights(currentFeatures.f, currentFeatures.d, currentFeatures.lastCharScore, kq);
  localStorage.setItem("tx_weights", JSON.stringify(weights));
  alert("Đã học xong. Trọng số cập nhật.");
}

  </script>
</body>
</html>

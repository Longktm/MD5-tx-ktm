<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KTM TOOL - THORP AI</title>
  <style>
    body { font-family: monospace; background: black; color: #00FF00; padding: 1rem; font-size: 20px; }
    input, button, select { font-size: 24px; padding: 8px; margin: 5px; }
    .block { margin-bottom: 1rem; }
    .warning { color: yellow; }
    .result-box { font-size: 32px; margin: 1rem 0; }
    .history { max-height: 200px; overflow-y: auto; border: 1px solid #00FF00; padding: 10px; }
    label { display: inline-block; width: 120px; }
  </style>
</head>
<body>
  <h1>KTM TOOL - THORP AI</h1>
  <div class="block">
    <label for="md5">Mã MD5:</label>
    <input id="md5" type="text" size="40">
    <button onclick="analyze()">Phân tích</button>
  </div>
  <div class="block">
    <div id="result" class="result-box"></div>
    <div id="evDisplay"></div>
  </div>
  <div class="block">
    <label>Thực tế:</label>
    <select id="actual">
      <option value="">--</option>
      <option value="tài">Tài</option>
      <option value="xỉu">Xỉu</option>
    </select>
    <button onclick="confirmResult()">Xác nhận kết quả đúng</button>
  </div>
  <div class="block history" id="history"></div>  <script>
    const db = JSON.parse(localStorage.getItem("ktm_data") || "[]")

    function extractFeatures(md5) {
      const f = [...md5].filter(c => /[a-f]/i.test(c)).length;
      const d = [...md5].filter(c => /[0-9]/.test(c)).length;
      const last = md5[md5.length - 1] || "";
      return { f, d, last };
    }

    function predict({ f, d, last }) {
      let score = 0;
      if (f > d) score += 1; else score -= 1;
      if ("abcdef".includes(last)) score += 1; else score -= 1;
      if (f % 2 === 0) score += 0.5; else score -= 0.5;

      // EV estimation (Edward Thorp style)
      const ev = (score > 0) ? 0.6 : (score < 0 ? 0.4 : 0.5);
      return {
        suggest: score > 0 ? "Tài" : score < 0 ? "Xỉu" : "Không chắc chắn",
        warning: score === 0,
        ev: ev
      };
    }

    function analyze() {
      const md5 = document.getElementById("md5").value.trim().toLowerCase();
      if (!/^[a-f0-9]{32}$/.test(md5)) return alert("Mã MD5 không hợp lệ");

      const features = extractFeatures(md5);
      const { suggest, warning, ev } = predict(features);
      document.getElementById("result").innerHTML = `Dự đoán: <b>${suggest}</b> ${warning ? '<span class="warning">⚠️</span>' : ''}`;
      document.getElementById("evDisplay").innerText = `EV: ${(ev * 100).toFixed(1)}%`;

      window.lastResult = { md5, features, suggest };
    }

    function confirmResult() {
      const actual = document.getElementById("actual").value;
      if (!window.lastResult || !actual) return alert("Vui lòng phân tích và chọn kết quả thực tế");
      db.push({
        md5: window.lastResult.md5,
        ...window.lastResult.features,
        suggest: window.lastResult.suggest,
        actual: actual
      });
      localStorage.setItem("ktm_data", JSON.stringify(db));
      updateHistory();
      document.getElementById("actual").value = "";
    }

    function updateHistory() {
      const html = db.slice(-10).reverse().map(r => {
        const correct = r.suggest.toLowerCase() === r.actual;
        return `${r.md5.slice(0, 8)}... | Dự đoán: <b>${r.suggest}</b> | Thực tế: <b>${r.actual}</b> ${correct ? '✅' : '❌'}`;
      }).join("<br>");
      document.getElementById("history").innerHTML = html;
    }

    updateHistory();
  </script></body>
</html>

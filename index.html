<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KTM Tool - Phân Tích MD5 Tài Xỉu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #111;
      color: #0f0;
      font-size: 20px;
    }
    input, button, select {
      font-size: 20px;
      padding: 10px;
      margin-top: 10px;
    }
    textarea {
      width: 100%;
      font-size: 18px;
    }
    .result {
      font-weight: bold;
      margin-top: 10px;
    }
    .warning {
      color: yellow;
    }
  </style>
</head>
<body>
  <h1>KTM Tool - Hacker Tài Xỉu</h1>
  <label for="md5">Nhập mã MD5:</label><br>
  <input type="text" id="md5" style="width:100%"><br>  <div class="result" id="suggestion"></div><label>Kết quả đúng là:</label><br> <input type="radio" name="trueResult" value="tài"> Tài <input type="radio" name="trueResult" value="xỉu"> Xỉu <button onclick="trainAI()">Lưu và Học</button><br>

  <textarea id="log" rows="10" readonly></textarea>  <script>
    const weights = JSON.parse(localStorage.getItem('weights') || '{"f":0, "d":0, "last":0}');
    const data = JSON.parse(localStorage.getItem('data') || '[]');

    function extractFeatures(md5) {
      const f = (md5.match(/f/gi) || []).length;
      const d = (md5.match(/d/gi) || []).length;
      const lastChar = md5.trim().slice(-1);
      const lastVal = isNaN(parseInt(lastChar, 16)) ? 0 : parseInt(lastChar, 16);
      return { f, d, last: lastVal };
    }

    function predict(md5) {
      const { f, d, last } = extractFeatures(md5);
      const score = f * weights.f + d * weights.d + last * weights.last;
      const ev = Math.round(Math.abs(score) * 3 + 40); // thorp-like expected value
      const result = score >= 0 ? 'xỉu' : 'tài';
      const warning = ev < 55 ? ' ⚠️ Không chắc chắn!' : '';
      document.getElementById('suggestion').innerHTML = `➡️ Gợi ý: <b>${result.toUpperCase()}</b> | EV: ${ev}%${warning}`;
      return { f, d, last, result, ev };
    }

    document.getElementById('md5').addEventListener('input', (e) => {
      const val = e.target.value.trim();
      if (val.length >= 10) predict(val);
    });

    function trainAI() {
      const md5 = document.getElementById('md5').value.trim();
      const radios = document.getElementsByName('trueResult');
      let actual = '';
      for (const r of radios) if (r.checked) actual = r.value;
      if (!md5 || !actual) return alert('Vui lòng nhập MD5 và chọn kết quả đúng.');
      const { f, d, last } = extractFeatures(md5);
      data.push({ f, d, last, actual });

      // Logistic-style training: cập nhật trọng số dựa trên hướng sai lệch
      const newWeights = { f: weights.f, d: weights.d, last: weights.last };
      const lr = 0.02;
      for (const { f, d, last, actual } of data) {
        const target = actual === 'xỉu' ? 1 : -1;
        const pred = f * weights.f + d * weights.d + last * weights.last;
        const error = target - pred;
        newWeights.f += lr * error * f;
        newWeights.d += lr * error * d;
        newWeights.last += lr * error * last;
      }
      weights.f = newWeights.f;
      weights.d = newWeights.d;
      weights.last = newWeights.last;

      localStorage.setItem('weights', JSON.stringify(weights));
      localStorage.setItem('data', JSON.stringify(data));
      document.getElementById('log').value = `Đã học từ ${data.length} mẫu.\nTrọng số hiện tại:\nF: ${weights.f.toFixed(2)} | D: ${weights.d.toFixed(2)} | Last: ${weights.last.toFixed(2)}`;
      predict(md5);
    }

    // Hiển thị thông tin lúc đầu
    document.getElementById('log').value = `Trọng số hiện tại:\nF: ${weights.f.toFixed(2)} | D: ${weights.d.toFixed(2)} | Last: ${weights.last.toFixed(2)}\nĐã học ${data.length} lượt.`;
  </script></body>
</html>
